<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RocketYield - rETH Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #FF6B35 0%, #1A1A1A 50%, #FF6B35 100%);
            min-height: 100vh;
            color: #ffffff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #FF6B35;
        }

        .update-status {
            margin: 20px auto;
            padding: 12px 24px;
            background: rgba(26, 26, 26, 0.85);
            border-radius: 30px;
            display: inline-block;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(26, 26, 26, 0.85);
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            padding: 25px;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.2);
        }

        .card h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #FF6B35;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
        }

        th {
            background: rgba(255, 107, 53, 0.2);
            color: #FF6B35;
            cursor: pointer;
            font-weight: 600;
        }

        th:hover {
            background: rgba(255, 107, 53, 0.3);
        }

        .btn {
            padding: 8px 16px;
            background: rgba(26, 26, 26, 0.7);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            margin: 2px;
        }

        .btn:hover {
            background: rgba(255, 107, 53, 0.5);
        }

        .btn.active {
            background: #FF6B35;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .yield-badge {
            background: #FF6B35;
            color: white;
        }

        .risk-low {
            background: #10b981;
            color: white;
        }

        .risk-medium {
            background: #FF8C42;
            color: white;
        }

        .risk-high {
            background: #ef4444;
            color: white;
        }

        .chain-ethereum {
            background: #627EEA;
            color: white;
        }

        .chain-optimism {
            background: #dc2626;
            color: white;
        }

        .chain-arbitrum {
            background: #2563eb;
            color: white;
        }

        .chain-base {
            background: #0052ff;
            color: white;
        }

        .chain-polygon {
            background: #8247e5;
            color: white;
        }

        .link {
            color: #FF6B35;
            text-decoration: none;
        }

        .link:hover {
            color: #FFA500;
            text-decoration: underline;
        }

        .filters {
            margin-bottom: 15px;
        }

        .filter-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .chart-container {
            height: 250px;
            position: relative;
        }

        .metric {
            background: rgba(255, 107, 53, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #FF6B35;
        }

        .metric-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2rem;
            }
            table {
                font-size: 0.8rem;
            }
            th, td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RocketYield Analytics</h1>
            <p>Real-time DeFi opportunities for Rocket Pool rETH holders</p>
            <div class="update-status">
                <span id="status">Loading data...</span>
                <button class="btn" onclick="refreshData()" style="margin-left: 15px;">Refresh</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="card full-width">
                <h3>Top Opportunities</h3>
                <div class="filters">
                    <div class="filter-group">
                        <span>Risk: </span>
                        <button class="btn active" id="risk-all" onclick="filterRisk('all')">All</button>
                        <button class="btn" id="risk-low" onclick="filterRisk('low')">Low</button>
                        <button class="btn" id="risk-medium" onclick="filterRisk('medium')">Medium</button>
                        <button class="btn" id="risk-high" onclick="filterRisk('high')">High</button>
                    </div>
                    <div class="filter-group">
                        <span>Chain: </span>
                        <button class="btn active" id="chain-all" onclick="filterChain('all')">All</button>
                        <button class="btn" id="chain-ethereum" onclick="filterChain('ethereum')">Ethereum</button>
                        <button class="btn" id="chain-optimism" onclick="filterChain('optimism')">Optimism</button>
                        <button class="btn" id="chain-arbitrum" onclick="filterChain('arbitrum')">Arbitrum</button>
                        <button class="btn" id="chain-base" onclick="filterChain('base')">Base</button>
                        <button class="btn" id="chain-polygon" onclick="filterChain('polygon')">Polygon</button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortData('name')">Strategy</th>
                                <th onclick="sortData('apr')">APR</th>
                                <th onclick="sortData('risk')">Risk</th>
                                <th onclick="sortData('tvl')">TVL</th>
                                <th onclick="sortData('chain')">Chain</th>
                                <th onclick="sortData('updated')">Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Risk vs Reward</h3>
                <div class="chart-container">
                    <canvas id="riskChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>Portfolio Metrics</h3>
                <div class="metric">
                    <div class="metric-value" id="avgApr">0%</div>
                    <div class="metric-label">Average APR</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="avgRisk">0</div>
                    <div class="metric-label">Average Risk</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="totalTvl">$0</div>
                    <div class="metric-label">Total TVL</div>
                </div>
            </div>

            <div class="card full-width">
                <h3>Yield by Chain</h3>
                <div class="chart-container">
                    <canvas id="chainChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        var data = [];
        var filtered = [];
        var sortKey = 'apr';
        var sortDir = 'desc';
        var riskFilter = 'all';
        var chainFilter = 'all';
        var charts = {};

        // Protocol URLs
        var urls = {
            'Hold rETH': 'https://rocketpool.net',
            'Balancer rETH/WETH + Aura': 'https://app.balancer.fi',
            'Gamma rETH/WETH': 'https://app.gamma.xyz',
            'Curve rETH/ETH': 'https://curve.fi',
            'Balancer wstETH/rETH/sfrxETH': 'https://app.balancer.fi',
            'BeethovenX rETH/WETH': 'https://beets.fi',
            'Balancer rETH/WETH (Arbitrum)': 'https://app.balancer.fi',
            'Balancer rETH/WETH (Base)': 'https://app.balancer.fi',
            'Aave v3 rETH Supply': 'https://app.aave.com',
            'Balancer rETH/weETH': 'https://app.balancer.fi',
            'Velodrome rETH/WETH': 'https://app.velodrome.finance',
            'Camelot rETH/WETH': 'https://app.camelot.exchange',
            'Aerodrome rETH/WETH': 'https://aerodrome.finance',
            'QuickSwap rETH/WETH': 'https://quickswap.exchange',
            'SushiSwap rETH/WETH': 'https://www.sushi.com'
        };

        // Initialize data
        function initData() {
            data = [
                {name: 'Hold rETH', apr: 2.89, risk: 2, chain: 'ethereum', tvl: 2500000000, updated: new Date()},
                {name: 'Balancer rETH/WETH + Aura', apr: 4.25, risk: 4, chain: 'ethereum', tvl: 45000000, updated: new Date()},
                {name: 'Gamma rETH/WETH', apr: 5.80, risk: 4, chain: 'ethereum', tvl: 12000000, updated: new Date()},
                {name: 'Curve rETH/ETH', apr: 3.45, risk: 4, chain: 'ethereum', tvl: 85000000, updated: new Date()},
                {name: 'Balancer wstETH/rETH/sfrxETH', apr: 6.20, risk: 6, chain: 'ethereum', tvl: 28000000, updated: new Date()},
                {name: 'BeethovenX rETH/WETH', apr: 3.80, risk: 5, chain: 'optimism', tvl: 8500000, updated: new Date()},
                {name: 'Balancer rETH/WETH (Arbitrum)', apr: 3.15, risk: 5, chain: 'arbitrum', tvl: 15000000, updated: new Date()},
                {name: 'Balancer rETH/WETH (Base)', apr: 4.10, risk: 5, chain: 'base', tvl: 6000000, updated: new Date()},
                {name: 'Aave v3 rETH Supply', apr: 1.91, risk: 3, chain: 'ethereum', tvl: 125000000, updated: new Date()},
                {name: 'Balancer rETH/weETH', apr: 4.85, risk: 6, chain: 'ethereum', tvl: 18000000, updated: new Date()},
                {name: 'Velodrome rETH/WETH', apr: 5.20, risk: 5, chain: 'optimism', tvl: 22000000, updated: new Date()},
                {name: 'Camelot rETH/WETH', apr: 4.65, risk: 5, chain: 'arbitrum', tvl: 9500000, updated: new Date()},
                {name: 'Aerodrome rETH/WETH', apr: 4.90, risk: 5, chain: 'base', tvl: 11000000, updated: new Date()},
                {name: 'QuickSwap rETH/WETH', apr: 3.25, risk: 5, chain: 'polygon', tvl: 4500000, updated: new Date()},
                {name: 'SushiSwap rETH/WETH', apr: 2.85, risk: 4, chain: 'ethereum', tvl: 7800000, updated: new Date()}
            ];

            // Set random update times
            for (var i = 0; i < data.length; i++) {
                var hoursAgo = Math.floor(Math.random() * 24);
                var d = new Date();
                d.setHours(d.getHours() - hoursAgo);
                data[i].updated = d;
            }

            filtered = data.slice();
        }

        // Render table
        function renderTable() {
            var tbody = document.getElementById('dataTable');
            var html = '';
            
            for (var i = 0; i < filtered.length; i++) {
                var item = filtered[i];
                var riskClass = item.risk <= 3 ? 'risk-low' : item.risk <= 6 ? 'risk-medium' : 'risk-high';
                var url = urls[item.name] || '#';
                
                html += '<tr>';
                html += '<td><a href="' + url + '" target="_blank" class="link">' + item.name + '</a></td>';
                html += '<td><span class="badge yield-badge">' + item.apr.toFixed(2) + '%</span></td>';
                html += '<td><span class="badge ' + riskClass + '">' + item.risk + '/10</span></td>';
                html += '<td>' + formatTVL(item.tvl) + '</td>';
                html += '<td><span class="badge chain-' + item.chain + '">' + formatChain(item.chain) + '</span></td>';
                html += '<td>' + formatTime(item.updated) + '</td>';
                html += '</tr>';
            }
            
            tbody.innerHTML = html;
            updateMetrics();
        }

        // Format TVL
        function formatTVL(tvl) {
            if (tvl >= 1e9) return '$' + (tvl / 1e9).toFixed(1) + 'B';
            if (tvl >= 1e6) return '$' + (tvl / 1e6).toFixed(1) + 'M';
            if (tvl >= 1e3) return '$' + (tvl / 1e3).toFixed(1) + 'K';
            return '$' + tvl;
        }

        // Format chain name
        function formatChain(chain) {
            var names = {
                ethereum: 'Ethereum',
                optimism: 'Optimism',
                arbitrum: 'Arbitrum',
                base: 'Base',
                polygon: 'Polygon'
            };
            return names[chain] || chain;
        }

        // Format time
        function formatTime(date) {
            var now = new Date();
            var diff = now - date;
            var hours = Math.floor(diff / 3600000);
            
            if (hours < 1) return 'Just now';
            if (hours < 24) return hours + 'h ago';
            return Math.floor(hours / 24) + 'd ago';
        }

        // Update metrics
        function updateMetrics() {
            var totalApr = 0;
            var totalRisk = 0;
            var totalTvl = 0;
            
            for (var i = 0; i < filtered.length; i++) {
                totalApr += filtered[i].apr;
                totalRisk += filtered[i].risk;
                totalTvl += filtered[i].tvl;
            }
            
            var count = filtered.length || 1;
            document.getElementById('avgApr').textContent = (totalApr / count).toFixed(2) + '%';
            document.getElementById('avgRisk').textContent = (totalRisk / count).toFixed(1);
            document.getElementById('totalTvl').textContent = formatTVL(totalTvl);
        }

        // Sort data
        function sortData(key) {
            if (sortKey === key) {
                sortDir = sortDir === 'asc' ? 'desc' : 'asc';
            } else {
                sortKey = key;
                sortDir = 'desc';
            }
            
            filtered.sort(function(a, b) {
                var aVal = key === 'updated' ? a[key].getTime() : a[key];
                var bVal = key === 'updated' ? b[key].getTime() : b[key];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (sortDir === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            renderTable();
        }

        // Filter by risk
        function filterRisk(level) {
            riskFilter = level;
            document.querySelectorAll('[id^="risk-"]').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.getElementById('risk-' + level).classList.add('active');
            applyFilters();
        }

        // Filter by chain
        function filterChain(chain) {
            chainFilter = chain;
            document.querySelectorAll('[id^="chain-"]').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.getElementById('chain-' + chain).classList.add('active');
            applyFilters();
        }

        // Apply filters
        function applyFilters() {
            filtered = data.filter(function(item) {
                var riskMatch = true;
                var chainMatch = true;
                
                if (riskFilter !== 'all') {
                    if (riskFilter === 'low') riskMatch = item.risk <= 3;
                    if (riskFilter === 'medium') riskMatch = item.risk >= 4 && item.risk <= 6;
                    if (riskFilter === 'high') riskMatch = item.risk >= 7;
                }
                
                if (chainFilter !== 'all') {
                    chainMatch = item.chain === chainFilter;
                }
                
                return riskMatch && chainMatch;
            });
            
            sortData(sortKey);
            updateCharts();
        }

        // Refresh data
        function refreshData() {
            document.getElementById('status').textContent = 'Refreshing...';
            
            // Simulate data update
            for (var i = 0; i < 3; i++) {
                var idx = Math.floor(Math.random() * data.length);
                data[idx].apr = Math.max(0.5, data[idx].apr + (Math.random() - 0.5) * 0.5);
                data[idx].tvl = data[idx].tvl * (1 + (Math.random() - 0.5) * 0.1);
                data[idx].updated = new Date();
            }
            
            setTimeout(function() {
                applyFilters();
                document.getElementById('status').textContent = 'Data updated';
                setTimeout(function() {
                    document.getElementById('status').textContent = 'Live data active';
                }, 2000);
            }, 500);
        }

        // Initialize charts
        function initCharts() {
            // Risk vs Reward
            var ctx1 = document.getElementById('riskChart');
            if (ctx1 && window.Chart) {
                charts.risk = new Chart(ctx1, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Opportunities',
                            data: [],
                            backgroundColor: 'rgba(255, 107, 53, 0.6)',
                            borderColor: '#FF6B35',
                            borderWidth: 2,
                            pointRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Risk Score' },
                                ticks: { color: '#ccc' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                title: { display: true, text: 'APR (%)' },
                                ticks: { color: '#ccc' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }

            // Chain yields
            var ctx2 = document.getElementById('chainChart');
            if (ctx2 && window.Chart) {
                charts.chain = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Average APR',
                            data: [],
                            backgroundColor: ['#627EEA', '#dc2626', '#2563eb', '#0052ff', '#8247e5']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#ccc' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                ticks: { color: '#ccc' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }

            updateCharts();
        }

        // Update charts
        function updateCharts() {
            if (charts.risk) {
                charts.risk.data.datasets[0].data = filtered.map(function(item) {
                    return { x: item.risk, y: item.apr };
                });
                charts.risk.update();
            }

            if (charts.chain) {
                var chainData = {};
                filtered.forEach(function(item) {
                    if (!chainData[item.chain]) {
                        chainData[item.chain] = { total: 0, count: 0 };
                    }
                    chainData[item.chain].total += item.apr;
                    chainData[item.chain].count++;
                });

                var labels = [];
                var values = [];
                for (var chain in chainData) {
                    labels.push(formatChain(chain));
                    values.push(chainData[chain].total / chainData[chain].count);
                }

                charts.chain.data.labels = labels;
                charts.chain.data.datasets[0].data = values;
                charts.chain.update();
            }
        }

        // Initialize on load
        window.onload = function() {
            initData();
            renderTable();
            initCharts();
            document.getElementById('status').textContent = 'Live data active';
            
            // Auto-refresh every 5 minutes
            setInterval(refreshData, 300000);
        };
    </script>
</body>
</html>